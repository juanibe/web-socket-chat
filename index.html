<h1>Real time messaging</h1>
<pre id="messages" style="height: 400px; overFlow: scroll"></pre>
<input type="text" id="message-box" placeholder="type your message here"
    style="display: block; width: 100%; margin-bottom: 10px; padding: 10px;">
<button id="send" title="Send message" style="width: 100%; height: 30px;">Send Message</button>

<script>
    (function () {
        const sendBtn = document.querySelector('#send');
        const messages = document.querySelector('#messages');
        const messageBox = document.querySelector('#messageBox');

        let ws;

        function showMessage(message) {
            message.textContext += `\n\n${message}`
            messages.scrollTop = messages.scrollHeight;
            messageBox.value = ''
        }

        function init() {
            if (ws) {
                ws.onerror = ws.onopen = es.onclose = null;
                ws.close()
            }

            ws = new WebSocket('ws://localhost:8080');
            ws.onopen = () => {
                console.log('Connection open')
            }

            ws.onmessage = ({ data }) => showMessage(data)
            ws.onclose = function () {
                ws = null;
            }
        }

        sendBtn.onclick = function () {
            if (!ws) {
                showMessage("No web socket connection :(")
                return;
            }

            ws.send(messsaeBox.value)
            showMessage(messageBox.value)

        }

        init()
    })();
</script>